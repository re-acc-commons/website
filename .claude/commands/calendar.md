# /calendar Command

Manage Google Calendar integration for meeting context and writeback.

## Usage

```
/calendar                     # Show calendar integration status
/calendar sync                # Process all pending writebacks
/calendar writeback <path>    # Write back specific transcript
/calendar lookup <path>       # Look up calendar context for transcript
/calendar rollback <event_id> # Undo a writeback
/calendar configure           # Configure calendar integration
```

## Philosophy

**Meetings live in calendars.** Your transcript processing shouldn't create a separate silo. When you process a meeting, the insights should flow back to where the meeting was scheduledâ€”so attendees can find notes without knowing about OPAL.

**Context improves extraction.** Knowing who was in a meeting (from calendar) dramatically improves entity extraction. "Speaker 1" becomes "Alice Smith" because we know Alice was an attendee.

---

## Calendar Status

```
/calendar

ğŸ“… Calendar Integration Status
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Connection: âœ… Connected (Google Calendar MCP)
Account: ben@example.com

ğŸ“¥ Meeting Context (Pre-processing):
â”œâ”€â”€ Enabled: Yes
â”œâ”€â”€ Calendars: primary, work@example.com
â”œâ”€â”€ Time window: Â±30 minutes
â”œâ”€â”€ Transcripts enriched: 23
â””â”€â”€ Last enrichment: 2 hours ago

ğŸ“¤ Writeback (Post-processing):
â”œâ”€â”€ Enabled: Yes
â”œâ”€â”€ Mode: smart_merge
â”œâ”€â”€ Create tasks: Yes (OPAL Action Items list)
â”œâ”€â”€ Events updated: 18
â”œâ”€â”€ Tasks created: 47
â””â”€â”€ Last writeback: 30 minutes ago

â³ Pending Writebacks (2):
â”œâ”€â”€ transcripts/planning-2026-02-01.md
â”‚   â””â”€â”€ Event: "Q1 Planning" (Feb 1, 2:00 PM)
â””â”€â”€ transcripts/standup-2026-02-02.md
    â””â”€â”€ Event: "Team Standup" (Feb 2, 9:00 AM)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Commands:
â€¢ /calendar sync - Write pending to calendar
â€¢ /calendar configure - Change settings
```

---

## Sync Writebacks

Process all pending calendar writebacks:

```
/calendar sync

ğŸ“¤ Syncing Calendar Writebacks
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[1/2] transcripts/planning-2026-02-01.md
â”œâ”€â”€ Event: "Q1 Planning" (Feb 1, 2:00 PM)
â”œâ”€â”€ Updating description...
â”‚   â”œâ”€â”€ Added: Meeting Summary (234 chars)
â”‚   â”œâ”€â”€ Added: Key Decisions (3 items)
â”‚   â””â”€â”€ Added: Action Items (5 items)
â”œâ”€â”€ Creating tasks...
â”‚   â”œâ”€â”€ âœ… "Draft Q1 roadmap" â†’ alice@example.com
â”‚   â”œâ”€â”€ âœ… "Review budget" â†’ bob@example.com
â”‚   â””â”€â”€ âœ… "Schedule kickoff" â†’ carol@example.com
â””â”€â”€ âœ… Complete

[2/2] transcripts/standup-2026-02-02.md
â”œâ”€â”€ Event: "Team Standup" (Feb 2, 9:00 AM)
â”œâ”€â”€ Updating description...
â”‚   â”œâ”€â”€ Added: Meeting Summary (156 chars)
â”‚   â””â”€â”€ Added: Action Items (2 items)
â”œâ”€â”€ Creating tasks...
â”‚   â”œâ”€â”€ âœ… "Fix login bug" â†’ alice@example.com
â”‚   â””â”€â”€ âœ… "Update docs" â†’ bob@example.com
â””â”€â”€ âœ… Complete

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Summary:
â€¢ Events updated: 2
â€¢ Tasks created: 5
â€¢ Errors: 0
```

---

## Write Back Specific Transcript

```
/calendar writeback transcripts/planning-2026-02-01.md

ğŸ“¤ Calendar Writeback
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Transcript: transcripts/planning-2026-02-01.md
Meeting time: 2026-02-01 14:00

Looking up calendar event...
âœ… Found: "Q1 Planning" (abc123xyz)
   Attendees: Alice Smith, Bob Jones, Carol White, David Park

Preview of calendar update:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ ## Meeting Summary
â”‚ Discussed Q1 priorities including the new product launch,
â”‚ resource allocation, and team structure changes. Agreed to
â”‚ increase engineering headcount and accelerate the timeline.
â”‚
â”‚ ## Key Decisions
â”‚ - Approved new hiring plan (3 engineers, 1 PM)
â”‚ - Budget increase for Project Phoenix approved
â”‚ - Launch date moved to March 15
â”‚
â”‚ ## Action Items
â”‚ - [ ] @alice: Draft Q1 roadmap by Feb 5
â”‚ - [ ] @bob: Review budget spreadsheet by Feb 3
â”‚ - [ ] @carol: Schedule team kickoff for Feb 10
â”‚ - [ ] @david: Prepare job descriptions by Feb 4
â”‚ - [ ] @alice: Send launch timeline to stakeholders
â”‚
â”‚ ---
â”‚ ğŸ“ Full notes: transcripts/planning-2026-02-01.md
â”‚ ğŸ¤– Generated by OPAL on 2026-02-02
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Write to calendar? [Y/n]
> y

Updating event description...
âœ… Event updated

Creating tasks...
â”œâ”€â”€ âœ… "Draft Q1 roadmap by Feb 5" â†’ alice@example.com (due: Feb 5)
â”œâ”€â”€ âœ… "Review budget spreadsheet by Feb 3" â†’ bob@example.com (due: Feb 3)
â”œâ”€â”€ âœ… "Schedule team kickoff for Feb 10" â†’ carol@example.com (due: Feb 10)
â”œâ”€â”€ âœ… "Prepare job descriptions by Feb 4" â†’ david@example.com (due: Feb 4)
â””â”€â”€ âœ… "Send launch timeline to stakeholders" â†’ alice@example.com

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Writeback complete
   Event updated: Q1 Planning
   Tasks created: 5
```

### Dry Run

```
/calendar writeback --dry-run transcripts/planning-2026-02-01.md

ğŸ“¤ Calendar Writeback (Dry Run)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Would update event: "Q1 Planning" (abc123xyz)
Would add to description: 487 characters
Would create 5 tasks

No changes made. Run without --dry-run to execute.
```

---

## Look Up Calendar Context

Test calendar lookup for a transcript without processing:

```
/calendar lookup transcripts/standup-2026-02-02.md

ğŸ“… Calendar Lookup
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Transcript: transcripts/standup-2026-02-02.md

Detecting meeting time...
â”œâ”€â”€ Filename pattern: standup-2026-02-02
â”œâ”€â”€ Detected date: 2026-02-02
â”œâ”€â”€ Content analysis: "9:00 AM standup"
â””â”€â”€ Detected time: 2026-02-02 09:00 (confidence: 0.9)

Searching calendars...
â”œâ”€â”€ Calendar: primary
â”‚   â””â”€â”€ Found: "Team Standup" (9:00 AM - 9:30 AM)
â”œâ”€â”€ Calendar: work@example.com
â”‚   â””â”€â”€ No matching events
â””â”€â”€ âœ… Best match: "Team Standup"

Event Details:
â”œâ”€â”€ Title: Team Standup
â”œâ”€â”€ Time: 2026-02-02 09:00 - 09:30
â”œâ”€â”€ Organizer: alice@example.com
â”œâ”€â”€ Attendees:
â”‚   â”œâ”€â”€ Alice Smith (alice@example.com) - Organizer, Accepted
â”‚   â”œâ”€â”€ Bob Jones (bob@example.com) - Accepted
â”‚   â””â”€â”€ Carol White (carol@example.com) - Accepted
â”œâ”€â”€ Location: Zoom (link available)
â””â”€â”€ Event ID: abc123xyz

This context will be used during /process to:
â€¢ Provide attendee names to transcript cleanup
â€¢ Help match speaker labels to real people
â€¢ Enable writeback of notes to this event
```

---

## Rollback Writeback

Undo a calendar writeback:

```
/calendar rollback abc123xyz

ğŸ“… Rollback Writeback
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Event ID: abc123xyz
Event: "Q1 Planning"

Looking up writeback history...
âœ… Found writeback from 2026-02-02 10:30

Changes made:
â”œâ”€â”€ Description: Added 487 characters
â””â”€â”€ Tasks created: 5
    â”œâ”€â”€ task_001: "Draft Q1 roadmap by Feb 5"
    â”œâ”€â”€ task_002: "Review budget spreadsheet by Feb 3"
    â”œâ”€â”€ task_003: "Schedule team kickoff for Feb 10"
    â”œâ”€â”€ task_004: "Prepare job descriptions by Feb 4"
    â””â”€â”€ task_005: "Send launch timeline to stakeholders"

This will:
â€¢ Restore original event description (was empty)
â€¢ Delete 5 created tasks

Proceed with rollback? [y/N]
> y

Rolling back...
â”œâ”€â”€ Restoring description... âœ…
â”œâ”€â”€ Deleting task_001... âœ…
â”œâ”€â”€ Deleting task_002... âœ…
â”œâ”€â”€ Deleting task_003... âœ…
â”œâ”€â”€ Deleting task_004... âœ…
â””â”€â”€ Deleting task_005... âœ…

âœ… Rollback complete
```

---

## Configure Integration

```
/calendar configure

ğŸ“… Calendar Configuration
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Current settings:

Meeting Context (Pre-processing):
â”œâ”€â”€ [1] Enabled: Yes
â”œâ”€â”€ [2] Time window: 30 minutes
â””â”€â”€ [3] Calendars: primary, work@example.com

Writeback (Post-processing):
â”œâ”€â”€ [4] Enabled: Yes
â”œâ”€â”€ [5] Mode: smart_merge
â”œâ”€â”€ [6] Include summary: Yes
â”œâ”€â”€ [7] Include action items: Yes
â”œâ”€â”€ [8] Include key decisions: Yes
â”œâ”€â”€ [9] Create tasks: Yes
â”œâ”€â”€ [10] Task list: OPAL Action Items
â””â”€â”€ [11] Trigger: on_commit

Privacy:
â”œâ”€â”€ [12] Skip private events: Yes
â”œâ”€â”€ [13] Require confirmation: No
â””â”€â”€ [14] External attendees: warn

What would you like to change? (number or 'done')
> 5

Writeback mode options:
  [a] append - Add OPAL content after existing description
  [b] prepend - Add OPAL content before existing
  [c] replace - Replace description (only if empty or OPAL-generated)
  [d] smart_merge - Update OPAL sections, preserve others

Choice: d

âœ… Updated: Writeback mode â†’ smart_merge
```

---

## Configuration File

Settings are stored in `.opal/sources.yaml`:

```yaml
# Google Calendar Integration
google_calendar:
  enabled: true
  mcp_server: google-calendar  # Or use API directly

  # Which calendars to search
  calendars:
    - primary
    - work@example.com

  # Meeting context enrichment (pre-processing)
  meeting_context:
    enabled: true
    time_window_minutes: 30

  # Calendar writeback (post-processing)
  writeback:
    enabled: true

    # What to write
    content:
      summary: true
      action_items: true
      key_decisions: true
      opal_link: true

    # How to handle existing description
    mode: smart_merge  # append | prepend | replace | smart_merge

    # Task creation
    tasks:
      enabled: true
      list_name: "OPAL Action Items"
      include_due_dates: true

    # When to trigger
    trigger: on_commit  # on_commit | manual

    # Safety
    require_confirmation: false

  # Privacy
  privacy:
    skip_private_events: true
    external_attendees: warn  # skip | warn | proceed
```

---

## Pipeline Integration

Calendar integration hooks into the processing pipeline:

```
/process transcripts/standup-2026-02-02.md

ğŸ“š Processing: standup-2026-02-02.md
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[CLASSIFY] Transcript (0.95)

[CALENDAR CONTEXT] â† NEW
â”œâ”€â”€ Detected: 2026-02-02 09:00 AM
â”œâ”€â”€ Found: "Team Standup"
â”œâ”€â”€ Attendees: Alice Smith, Bob Jones, Carol White
â””â”€â”€ âœ… Context enriched

[CLEANUP]
â”œâ”€â”€ Known speakers: Alice Smith, Bob Jones, Carol White
â”œâ”€â”€ Matched: Speaker 1 â†’ Alice Smith
â”œâ”€â”€ Matched: Speaker 2 â†’ Bob Jones
â””â”€â”€ âœ… Cleaned (12% reduction)

[EXTRACT]
â”œâ”€â”€ Attendee context provided
â”œâ”€â”€ Entities: 8 found
â”œâ”€â”€ People: Alice âœ“, Bob âœ“, Carol âœ“ (matched to attendees)
â”œâ”€â”€ Action items: 3
â””â”€â”€ âœ… Extracted

[RECONCILE] ...
[STAGE] ...

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Staged for review. Calendar writeback will occur after commit.
```

After `/review` accepts and commits:

```
[COMMIT] âœ… Changes committed

[CALENDAR WRITEBACK]
â”œâ”€â”€ Event: Team Standup (abc123xyz)
â”œâ”€â”€ Updating description... âœ…
â”œâ”€â”€ Creating 3 tasks... âœ…
â””â”€â”€ âœ… Calendar updated

ğŸ“ Meeting notes are now in your calendar!
```

---

## Error Messages

```
âš ï¸ Calendar Integration Warning

Could not find matching calendar event for:
  transcripts/mystery-meeting-2026-02-02.md

Possible reasons:
â€¢ Meeting time couldn't be detected from content
â€¢ No event at detected time (2026-02-02 ~10:00 AM)
â€¢ Calendar access not configured

The transcript will be processed without calendar enrichment.
Writeback will be skipped.

To resolve:
â€¢ /calendar configure - Check calendar settings
â€¢ Add meeting_date/meeting_time to transcript frontmatter
â€¢ Manually link: /calendar link <transcript> <event_id>
```

---

## Related Commands

- `/process` - Process transcripts (uses calendar context)
- `/review` - Review staged changes (triggers writeback on commit)
- `/sync` - Sync from sources (includes calendar-based routing)
- `/status` - Overall status (includes calendar)
